{% extends "template.njk" %}

{% block content %}
  <h1 class="govuk-heading-l">Case Details POC</h1>

  <p class="govuk-body">
    <strong>Case Reference:</strong> {{ caseReference }}
  </p>

  {% if error %}
    <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" data-module="govuk-error-summary">
      <h2 class="govuk-error-summary__title" id="error-summary-title">
        Error
      </h2>
      <div class="govuk-error-summary__body">
        <p>{{ error }}</p>
      </div>
    </div>
  {% endif %}

  {% if caseData %}
    <h2 class="govuk-heading-m">Case Information</h2>
    
    <dl class="govuk-summary-list">
      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">Case ID</dt>
        <dd class="govuk-summary-list__value">{{ caseData.id }}</dd>
      </div>
    </dl>

    <h2 class="govuk-heading-m">Case Data</h2>

    {% if caseData.data %}
      
      <dl class="govuk-summary-list">
        {% if caseData.data.applicantForename or caseData.data.applicantSurname %}
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Applicant Name</dt>
            <dd class="govuk-summary-list__value">
              {{ caseData.data.applicantForename }} {{ caseData.data.applicantSurname }}
            </dd>
          </div>
        {% endif %}

        {% if caseData.data.propertyAddress %}
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Property Address</dt>
            <dd class="govuk-summary-list__value">
              {% if caseData.data.propertyAddress.AddressLine1 %}{{ caseData.data.propertyAddress.AddressLine1 }}<br>{% endif %}
              {% if caseData.data.propertyAddress.AddressLine2 %}{{ caseData.data.propertyAddress.AddressLine2 }}<br>{% endif %}
              {% if caseData.data.propertyAddress.AddressLine3 %}{{ caseData.data.propertyAddress.AddressLine3 }}<br>{% endif %}
              {% if caseData.data.propertyAddress.PostTown %}{{ caseData.data.propertyAddress.PostTown }}<br>{% endif %}
              {% if caseData.data.propertyAddress.County %}{{ caseData.data.propertyAddress.County }}<br>{% endif %}
              {% if caseData.data.propertyAddress.PostCode %}{{ caseData.data.propertyAddress.PostCode }}<br>{% endif %}
              {% if caseData.data.propertyAddress.Country %}{{ caseData.data.propertyAddress.Country }}{% endif %}
            </dd>
          </div>
        {% endif %}

        {% if caseData.data.tenancyLicenceDocuments and caseData.data.tenancyLicenceDocuments.length > 0 %}
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Uploaded Documents</dt>
            <dd class="govuk-summary-list__value">
              <ul class="govuk-list">
                {% for doc in caseData.data.tenancyLicenceDocuments %}
                  <li>
                    {% if doc.documentUuid %}
                      <a href="/case/{{ caseData.id }}/documents/{{ doc.documentUuid }}/download" class="govuk-link">
                        {{ doc.value.document_filename }}
                      </a>
                    {% else %}
                      <span class="govuk-body">{{ doc.value.document_filename }} (Unable to download - invalid document URL)</span>
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>
            </dd>
          </div>
        {% endif %}

        {% if caseData.data.userPcqId %}
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">PCQ ID</dt>
            <dd class="govuk-summary-list__value">{{ caseData.data.userPcqId }}</dd>
          </div>
        {% endif %}
      </dl>
    {% endif %}
  {% endif %}

  <p class="govuk-body">
    <a href="/" class="govuk-link">Back to home</a>
  </p>

{% endblock %}
