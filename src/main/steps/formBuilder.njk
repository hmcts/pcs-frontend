{% extends "stepsTemplate.njk" %}

{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/textarea/macro.njk" import govukTextarea %}
{% from "govuk/components/character-count/macro.njk" import govukCharacterCount %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}
{% from "govuk/components/date-input/macro.njk" import govukDateInput %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    {% if error %}
      <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="govuk-error-summary">
        <h2 class="govuk-error-summary__title" id="error-summary-title">{{ errorSummaryTitle }}</h2>
        <div class="govuk-error-summary__body">
          <ul class="govuk-list govuk-error-summary__list">
            <li><a href="#{{ error.anchor or error.field }}">{{ error.text }}</a></li>
          </ul>
        </div>
      </div>
    {% endif %}

    {% if pageTitle %}
      <h1 class="govuk-heading-l">{{ pageTitle }}</h1>
    {% elif title %}
      <h1 class="govuk-heading-l">{{ title }}</h1>
    {% endif %}

    {% if content %}
      <p class="govuk-body">{{ content | safe }}</p>
    {% endif %}

    <form method="post" action="{{ url }}">
      {% for field in fields %}
        {% if field.component and field.componentType %}
          {% if field.componentType == 'input' %}
            {{ govukInput(field.component) }}
          {% elif field.componentType == 'textarea' %}
            {{ govukTextarea(field.component) }}
          {% elif field.componentType == 'characterCount' %}
            {{ govukCharacterCount(field.component) }}
          {% elif field.componentType == 'radios' %}
            {{ govukRadios(field.component) }}
          {% elif field.componentType == 'checkboxes' %}
            {{ govukCheckboxes(field.component) }}
          {% elif field.componentType == 'dateInput' %}
            {{ govukDateInput(field.component) }}
          {% endif %}
        {% endif %}
      {% endfor %}

      {% set excludedSteps = ['summary', 'ineligible', 'application-submitted'] %}
      {% set showSaveForLater = journeyFolder == 'userJourney' and stepName not in excludedSteps %}
      
      <div class="govuk-button-group">
        {{ govukButton({ 
          text: continue,
          attributes: { type: 'submit', name: 'action', value: 'continue' }
        }) }}
        {% if showSaveForLater %}
          {{ govukButton({ 
            text: saveForLater,
            classes: 'govuk-button--secondary',
            attributes: { type: 'submit', name: 'action', value: 'saveForLater' }
          }) }}
        {% endif %}
      </div>
      
      <p class="govuk-body">
        <a href="{{ dashboardUrl }}" class="govuk-link">{{ cancel }}</a>
      </p>
    </form>
  </div>
</div>
{% endblock %}

